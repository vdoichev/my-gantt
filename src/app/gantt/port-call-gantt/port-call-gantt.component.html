<!--<mat-button-toggle-group [(ngModel)]="viewMode">-->
<!--  <mat-button-toggle value="day">Day</mat-button-toggle>-->
<!--  <mat-button-toggle value="week">Week</mat-button-toggle>-->
<!--</mat-button-toggle-group>-->

<div class="vertical-scroll">
  <as-split direction="horizontal"
             [gutterSize]="8">
    <as-split-area [size]="50" [minSize]="20">
      <div class="table-pane">
        <app-port-call-gantt-table
          [tableDataSource]="tableDataSource"
          [treeControl]="treeControl"
          [rowHeaderHeight]="rowHeaderHeight"
          (hasGanttScroll)="onGanttScroll(xScroll.scrollLeft)"
        />
      </div>

    </as-split-area>

    <as-split-area [size]="50" [minSize]="20">
      <div class="gantt-pane" #rightArea>

        <div
          class="gantt-x-scroll"
          #xScroll
          (scroll)="onGanttScroll(xScroll.scrollLeft)">
          <div
            class="gantt-x-content"
            [style.width.px]="ganttContentWidth"
            [style.--gantt-width]="ganttContentWidth"
          >

            <div class="gantt-overlay">
              <div
                class="today-line"
                #todayLine
                [style.left.px]="todayOffset"
              ></div>
            </div>

            <table mat-table [dataSource]="tableDataSource">
              <!-- GANTT -->
              <ng-container matColumnDef="gantt">

                <th mat-header-cell *matHeaderCellDef class="gantt-header">
                  <app-port-call-gantt-calendar-header
                    [projectStart]="projectStart"
                    [projectEnd]="projectEnd"
                    [dayWidth]="dayWidth"
                    [weekWidth]="weekWidth"
                  ></app-port-call-gantt-calendar-header>
                </th>

                <td mat-cell *matCellDef="let node" class="gantt-cell">
                  <div class="timeline-wrapper">
                    <div class="timeline" #timeline>
                      <!-- Фонова сітка по днях -->
                      @for (d of timelineDays; track d.id) {
                        <div
                          class="timeline-day"
                          [style.left.px]="d.left"
                          [style.width.px]="d.width"
                          [class.weekend-day]="d.isWeekend"
                          [class.week-start]="d.isWeekStart"
                        ></div>
                      }

                      @if (isParentRow(node)) {
                        <!-- Для родителя: квадраты 40x40 по датам детей -->
                        @for (m of parentMarkers(node); track m.id) {
                          <div
                            class="parent-marker"
                            [class.parent-marker--start]="m.kind === 'start'"
                            [class.parent-marker--end]="m.kind === 'end'"
                            [style.left.px]="m.dayIndex * dayWidth + (dayWidth / 2) - 12"
                            [attr.title]="m.title"
                          ></div>
                        }
                      } @else {
                        <div
                          class="bar"
                          [style.left.px]="offset(node)"
                          [style.width.px]="width(node)">
                        </div>
                      }
                    </div>
                  </div>
                </td>

<!--                 FOOTER: ОДИН X-SCROLL-->
<!--                <td mat-footer-cell *matFooterCellDef class="gantt-footer">-->
<!--                </td>-->

              </ng-container>

              <tr mat-header-row *matHeaderRowDef="rightColumns" [style.height.px]="rowHeaderHeight"></tr>
              <tr mat-row *matRowDef="let row; let i = index; columns: ['gantt']"
                  [style.height.px]="rowHeights[i]"></tr>
<!--              <tr mat-footer-row *matFooterRowDef="rightColumns" [style.height.px]="16"></tr>-->

            </table>

          </div>
        </div>

      </div>
    </as-split-area>
  </as-split>
</div>
